<% layout('layouts/boilerplate.ejs') -%>

    <body>
        <div class="card-body text-start">
            <h5 class="card-title"><%= listing.title %></h5>
        <div class="card col-12 col-md-8 listing-card ">
          <% const imgUrl = listing && listing.image && (listing.image.url || listing.image); %>
          <div class="d-flex justify-content-center my-3">
            <img src="<%= imgUrl || '/images/default.jpg' %>" class="card-img-top mx-auto"
                 style="height:20rem; width:auto; max-width:100%; object-fit:cover;" alt="listing image">
          </div>
        
         
        
            <ul class="list-unstyled ps-0">
              <li><%= listing.description %></li>
              <li><%= listing.price ? 'â‚¹' + listing.price.toLocaleString('en-IN') + ' /night' : 'N/A' %></li>
              <li><%= listing.location %></li>
              <li><%= listing.country %></li>
            </ul>
        
            <!-- place Edit, Delete and Back in a single responsive row -->
            
<hr>
            <div class="col-8 offset-3">
                <h4>Leave a Review</h4>
                <form action="/listings/<%=listing._id%>/reviews" method="post" novalidate class="needs-validation">
                    <div class="mb-3 mt3">
                        <label for="rating" class="form-label">Rating</label>
                        <input type="range" class="form-range" min='1' max='5' step="1" id="rating" name="review[rating]">
                    </div>
                    <div class="mb-3 mt3">
                        <label for="comment" class="form-label">Comment</label>
                        <textarea name="review[comment]" class=form-control id="comment" cols="30" rows="1" required></textarea>
                        <div class="invalid-feedback">Please enter a valid comment</div>
                    </div> <br>
                    <button class="btn btn-outline-dark">submit</button>
                </form>
                </div>
                <hr>
                <p><b>All Reviews</b></p>
                <div class="row ">
                  <% for(let review of listing.reviews){ %>
                     <div class="card col-5 ms-2 mb-2">
                      <div class="card-body">
                      <h5 class="card-title">User name</h5>
                      <p class="card-text"> <%=review.comment%> </p>
                      <p class="card-text"><%=review.rating%> &#9734</p>  
                      </div>
                      <FORM class="mb-3" method="post" action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                        <button class="btn btn-sm btn-danger">Delete</button>
                      </FORM>
                      </div>
                <% } %>
                </div>
                </div>

            </div>
            <div class="row mt-3 align-items-center">
              <div class="col-md-6 d-flex gap-2">
                <a href="/listings/<%= listing._id %>/edit" class="btn btn-outline-primary">Edit</a>
                <form action="/listings/<%= listing._id %>?_method=DELETE" method="post" class="m-0">
                  <button class="btn btn-danger">Delete</button>
                </form>
              </div>
              <div class="col-md-6 text-md-end">
                <a href="/listings" class="btn btn-dark">Back</a>
              </div>
            </div>
          </div>
        </div>